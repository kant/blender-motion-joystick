


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xml:lang="" lang="" version="-//W3C//DTD XHTML 1.1//EN" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>mpu9250_i2c &mdash; blender-motion-joystick 1.0 documentation</title>
  

  

  

    <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" href="../_static/css/pdj.css" type="text/css" />

  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="blender-motion-joystick 1.0 documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="cache-control" content="public" />
    <meta name="robots" content="follow, all" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Add jQuery library -->
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

  </head>

  <body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> blender-motion-joystick </a>
        <div role="search">
	  <form id ="rtd-search-form" class="wy-form"
		action="../search.html" method="get">
	    <input type="text" name="q" placeholder="Search docs" />
	    <input type="hidden" name="check_keywords" value="yes" />
	    <input type="hidden" name="area" value="default" />
	  </form>
	</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	
          
          
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wiring.html">Wiring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c.html">i2c interfacing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../i2c.html#module-mpu9250_i2c">MPU9250_i2c</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i2c.html#module-joystick_reader">joystick_reader</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../blender.html">blender addon</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../blender.html#module-__init__">joystick_control (the blender files)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../thoughts.html">final thoughts</a></li>
</ul>

          
        

      </div>
      &nbsp;
    </nav>
    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      <nav class="wy-nav-top" id="barra-mobile" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="#">Por√£o do Juca</a>
      </nav>

      <div class="wy-nav-content">
	<div class="fundo-claro">
	</div>
	<div class="fundo-escuro">
	</div>

        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
	    
	    <!-- <ul class="wy-breadcrumbs"> -->
	    <!--   <li><a href="#">Docs</a> &raquo;</li> -->

	    <!--   <li>Features</li> -->
	    <!--   <li class="wy-breadcrumbs-aside"> -->

	    <!-- 	<a href="_sources/index.txt" rel="nofollow"> View page source</a> -->

	    <!--   </li> -->
	    <!-- </ul> -->
	    <!-- <hr/> -->
	  </div>

          <div role="main" class="">

	    <div id="content" class="hfeed entry-container hentry">
  <h1>Source code for mpu9250_i2c</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module interfaces directly with the sensor.</span>

<span class="sd">This code was largely taken from `this article by Joshua Hrisko &lt;https://makersportal.com/blog/2019/11/11/raspberry-pi-python-accelerometer-gyroscope-magnetometer&gt;`_.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">smbus</span><span class="o">,</span> <span class="nn">time</span>

<div class="viewcode-block" id="MPU6050_start"><a class="viewcode-back" href="../i2c.html#mpu9250_i2c.MPU6050_start">[docs]</a><span class="k">def</span> <span class="nf">MPU6050_start</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This function initializes the sensor in the following manner:</span>

<span class="sd">    1. Set the sample rate div to zero (no change in the sample rate.)</span>
<span class="sd">    2. Set the power management register to all zeros, with the following effects:</span>

<span class="sd">        *  Set to not sleep mode.</span>
<span class="sd">        *  Set to normal sample mode.</span>
<span class="sd">        *  Set to normal gyro power mode.</span>
<span class="sd">        *  Set to normal voltage generator mode.</span>
<span class="sd">        *  Set to default clock speed.</span>

<span class="sd">    3. Write the power management register again, to reset internal registers.</span>
<span class="sd">    4. Write the config register with all zeros, with the following effects:</span>

<span class="sd">        * Set FIFO mode to normal.</span>
<span class="sd">        * Set FSYNC to normal.</span>
<span class="sd">        * Set DLPF_CFG to normal.</span>

<span class="sd">    5. Write all zeros to the GYRO_CONFIG register with the following effects:</span>

<span class="sd">        * Set sample rate to 250 degrees/second</span>
<span class="sd">        * Do not bypass DPLF</span>

<span class="sd">    6. Write all zeros to the ACCEL_CONFIG register, setting the accel sample rate to +- 2g/second.</span>

<span class="sd">    7. Write a 1 to INT_ENABLE register, to enable interrupt when sensor gets any reading.</span>

<span class="sd">    :return: A tuple of (gyro sample rate, acceleration sample rate)</span>
<span class="sd">    :rtype: tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># alter sample rate (stability)</span>
    <span class="n">samp_rate_div</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># sample rate = 8 kHz/(1+samp_rate_div)</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">write_byte_data</span><span class="p">(</span><span class="n">MPU6050_ADDR</span><span class="p">,</span> <span class="n">SMPLRT_DIV</span><span class="p">,</span> <span class="n">samp_rate_div</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="c1"># reset all sensors</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">write_byte_data</span><span class="p">(</span><span class="n">MPU6050_ADDR</span><span class="p">,</span><span class="n">PWR_MGMT_1</span><span class="p">,</span><span class="mh">0x00</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="c1"># power management and crystal settings</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">write_byte_data</span><span class="p">(</span><span class="n">MPU6050_ADDR</span><span class="p">,</span> <span class="n">PWR_MGMT_1</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="c1">#Write to Configuration register</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">write_byte_data</span><span class="p">(</span><span class="n">MPU6050_ADDR</span><span class="p">,</span> <span class="n">CONFIG</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="c1">#Write to Gyro configuration register</span>
    <span class="n">gyro_config_sel</span> <span class="o">=</span> <span class="p">[</span><span class="mb">0b00000</span><span class="p">,</span><span class="mb">0b010000</span><span class="p">,</span><span class="mb">0b10000</span><span class="p">,</span><span class="mb">0b11000</span><span class="p">]</span> <span class="c1"># byte registers</span>
    <span class="n">gyro_config_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">250.0</span><span class="p">,</span><span class="mf">500.0</span><span class="p">,</span><span class="mf">1000.0</span><span class="p">,</span><span class="mf">2000.0</span><span class="p">]</span> <span class="c1"># degrees/sec</span>
    <span class="n">gyro_indx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">write_byte_data</span><span class="p">(</span><span class="n">MPU6050_ADDR</span><span class="p">,</span> <span class="n">GYRO_CONFIG</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">gyro_config_sel</span><span class="p">[</span><span class="n">gyro_indx</span><span class="p">]))</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="c1">#Write to Accel configuration register</span>
    <span class="n">accel_config_sel</span> <span class="o">=</span> <span class="p">[</span><span class="mb">0b00000</span><span class="p">,</span><span class="mb">0b01000</span><span class="p">,</span><span class="mb">0b10000</span><span class="p">,</span><span class="mb">0b11000</span><span class="p">]</span> <span class="c1"># byte registers</span>
    <span class="n">accel_config_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">16.0</span><span class="p">]</span> <span class="c1"># g (g = 9.81 m/s^2)</span>
    <span class="n">accel_indx</span> <span class="o">=</span> <span class="mi">0</span>                            
    <span class="n">bus</span><span class="o">.</span><span class="n">write_byte_data</span><span class="p">(</span><span class="n">MPU6050_ADDR</span><span class="p">,</span> <span class="n">ACCEL_CONFIG</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">accel_config_sel</span><span class="p">[</span><span class="n">accel_indx</span><span class="p">]))</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="c1"># interrupt register (related to overflow of data [FIFO])</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">write_byte_data</span><span class="p">(</span><span class="n">MPU6050_ADDR</span><span class="p">,</span> <span class="n">INT_ENABLE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gyro_config_vals</span><span class="p">[</span><span class="n">gyro_indx</span><span class="p">],</span><span class="n">accel_config_vals</span><span class="p">[</span><span class="n">accel_indx</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="read_raw_bits"><a class="viewcode-back" href="../i2c.html#mpu9250_i2c.read_raw_bits">[docs]</a><span class="k">def</span> <span class="nf">read_raw_bits</span><span class="p">(</span><span class="n">register</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This reads the raw bits at a high sensor register and the raw bits at the subsequent register (the low byte). It combines those value to get the total read for the sensor.</span>

<span class="sd">    :param register: The high byte of a sensor read register.</span>
<span class="sd">    :type register: byte</span>
<span class="sd">    :return: The sensor reading.</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># read accel and gyro values</span>
    <span class="n">high</span> <span class="o">=</span> <span class="n">bus</span><span class="o">.</span><span class="n">read_byte_data</span><span class="p">(</span><span class="n">MPU6050_ADDR</span><span class="p">,</span> <span class="n">register</span><span class="p">)</span>
    <span class="n">low</span> <span class="o">=</span> <span class="n">bus</span><span class="o">.</span><span class="n">read_byte_data</span><span class="p">(</span><span class="n">MPU6050_ADDR</span><span class="p">,</span> <span class="n">register</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># combine high and low for unsigned bit value</span>
    <span class="n">value</span> <span class="o">=</span> <span class="p">((</span><span class="n">high</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">low</span><span class="p">)</span>
    
    <span class="c1"># convert to +- value</span>
    <span class="k">if</span><span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">32768</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">-=</span> <span class="mi">65536</span>
    <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="mpu6050_conv"><a class="viewcode-back" href="../i2c.html#mpu9250_i2c.mpu6050_conv">[docs]</a><span class="k">def</span> <span class="nf">mpu6050_conv</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the sensor readings for each register by calling :py:func:`read_raw_bits` for each sensor register.</span>

<span class="sd">    Converts those readings to floats of the appropriate magnitude by multiplying by the quantity per second that the sensor is set to.</span>

<span class="sd">    :return: A tuple of (ax, ay, az, wx, wy, wz)</span>
<span class="sd">    :rtype: tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># raw acceleration bits</span>
    <span class="n">acc_x</span> <span class="o">=</span> <span class="n">read_raw_bits</span><span class="p">(</span><span class="n">ACCEL_XOUT_H</span><span class="p">)</span>
    <span class="n">acc_y</span> <span class="o">=</span> <span class="n">read_raw_bits</span><span class="p">(</span><span class="n">ACCEL_YOUT_H</span><span class="p">)</span>
    <span class="n">acc_z</span> <span class="o">=</span> <span class="n">read_raw_bits</span><span class="p">(</span><span class="n">ACCEL_ZOUT_H</span><span class="p">)</span>

    <span class="c1"># raw temp bits</span>
<span class="c1">##    t_val = read_raw_bits(TEMP_OUT_H) # uncomment to read temp</span>
    
    <span class="c1"># raw gyroscope bits</span>
    <span class="n">gyro_x</span> <span class="o">=</span> <span class="n">read_raw_bits</span><span class="p">(</span><span class="n">GYRO_XOUT_H</span><span class="p">)</span>
    <span class="n">gyro_y</span> <span class="o">=</span> <span class="n">read_raw_bits</span><span class="p">(</span><span class="n">GYRO_YOUT_H</span><span class="p">)</span>
    <span class="n">gyro_z</span> <span class="o">=</span> <span class="n">read_raw_bits</span><span class="p">(</span><span class="n">GYRO_ZOUT_H</span><span class="p">)</span>

    <span class="c1">#convert to acceleration in g and gyro dps</span>
    <span class="n">a_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">acc_x</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="mf">15.0</span><span class="p">))</span><span class="o">*</span><span class="n">accel_sens</span>
    <span class="n">a_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">acc_y</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="mf">15.0</span><span class="p">))</span><span class="o">*</span><span class="n">accel_sens</span>
    <span class="n">a_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">acc_z</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="mf">15.0</span><span class="p">))</span><span class="o">*</span><span class="n">accel_sens</span>

    <span class="n">w_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">gyro_x</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="mf">15.0</span><span class="p">))</span><span class="o">*</span><span class="n">gyro_sens</span>
    <span class="n">w_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">gyro_y</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="mf">15.0</span><span class="p">))</span><span class="o">*</span><span class="n">gyro_sens</span>
    <span class="n">w_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">gyro_z</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="mf">15.0</span><span class="p">))</span><span class="o">*</span><span class="n">gyro_sens</span>

<span class="c1">##    temp = ((t_val)/333.87)+21.0 # uncomment and add below in return</span>
    <span class="k">return</span> <span class="n">a_x</span><span class="p">,</span><span class="n">a_y</span><span class="p">,</span><span class="n">a_z</span><span class="p">,</span><span class="n">w_x</span><span class="p">,</span><span class="n">w_y</span><span class="p">,</span><span class="n">w_z</span></div>

<span class="k">def</span> <span class="nf">AK8963_start</span><span class="p">():</span>
    <span class="c1"># not used</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">write_byte_data</span><span class="p">(</span><span class="n">AK8963_ADDR</span><span class="p">,</span><span class="n">AK8963_CNTL</span><span class="p">,</span><span class="mh">0x00</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">AK8963_bit_res</span> <span class="o">=</span> <span class="mb">0b0001</span> <span class="c1"># 0b0001 = 16-bit</span>
    <span class="n">AK8963_samp_rate</span> <span class="o">=</span> <span class="mb">0b0110</span> <span class="c1"># 0b0010 = 8 Hz, 0b0110 = 100 Hz</span>
    <span class="n">AK8963_mode</span> <span class="o">=</span> <span class="p">(</span><span class="n">AK8963_bit_res</span> <span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="n">AK8963_samp_rate</span> <span class="c1"># bit conversion</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">write_byte_data</span><span class="p">(</span><span class="n">AK8963_ADDR</span><span class="p">,</span><span class="n">AK8963_CNTL</span><span class="p">,</span><span class="n">AK8963_mode</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">AK8963_reader</span><span class="p">(</span><span class="n">register</span><span class="p">):</span>
    <span class="c1"># not used</span>
    <span class="c1"># read magnetometer values</span>
    <span class="n">low</span> <span class="o">=</span> <span class="n">bus</span><span class="o">.</span><span class="n">read_byte_data</span><span class="p">(</span><span class="n">AK8963_ADDR</span><span class="p">,</span> <span class="n">register</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">high</span> <span class="o">=</span> <span class="n">bus</span><span class="o">.</span><span class="n">read_byte_data</span><span class="p">(</span><span class="n">AK8963_ADDR</span><span class="p">,</span> <span class="n">register</span><span class="p">)</span>
    <span class="c1"># combine higha and low for unsigned bit value    </span>
    <span class="n">value</span> <span class="o">=</span> <span class="p">((</span><span class="n">high</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">low</span><span class="p">)</span>
    <span class="c1"># convert to +- value</span>
    <span class="k">if</span><span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">32768</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">-=</span> <span class="mi">65536</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">AK8963_conv</span><span class="p">():</span>
    <span class="c1"># raw magnetometer bits</span>
    <span class="c1"># not used</span>

    <span class="n">loop_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">mag_x</span> <span class="o">=</span> <span class="n">AK8963_reader</span><span class="p">(</span><span class="n">HXH</span><span class="p">)</span>
        <span class="n">mag_y</span> <span class="o">=</span> <span class="n">AK8963_reader</span><span class="p">(</span><span class="n">HYH</span><span class="p">)</span>
        <span class="n">mag_z</span> <span class="o">=</span> <span class="n">AK8963_reader</span><span class="p">(</span><span class="n">HZH</span><span class="p">)</span>

        <span class="c1"># the next line is needed for AK8963</span>
        <span class="c1">#if bin(bus.read_byte_data(AK8963_ADDR,AK8963_ST2))==&#39;0b10000&#39;:</span>
        <span class="c1">#    break</span>
        <span class="n">loop_count</span><span class="o">+=</span><span class="mi">1</span>
        
    <span class="c1">#convert to acceleration in g and gyro dps</span>
    <span class="n">m_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">mag_x</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="mf">15.0</span><span class="p">))</span><span class="o">*</span><span class="n">mag_sens</span>
    <span class="n">m_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">mag_y</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="mf">15.0</span><span class="p">))</span><span class="o">*</span><span class="n">mag_sens</span>
    <span class="n">m_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">mag_z</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="mf">15.0</span><span class="p">))</span><span class="o">*</span><span class="n">mag_sens</span>

    <span class="k">return</span> <span class="n">m_x</span><span class="p">,</span><span class="n">m_y</span><span class="p">,</span><span class="n">m_z</span>

<span class="c1"># MPU6050 Registers</span>
<span class="n">MPU6050_ADDR</span> <span class="o">=</span> <span class="mh">0x68</span>  <span class="c1"># 104</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The i2c address of the sensor, which is 104.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">PWR_MGMT_1</span>   <span class="o">=</span> <span class="mh">0x6B</span>  <span class="c1"># 107</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Power management register </span>

<span class="sd">.. csv-table:: Bit Mapping</span>
<span class="sd">   :header: &quot;Bit&quot;,&quot;Name&quot;,&quot;Description&quot;</span>
<span class="sd">   </span>
<span class="sd">   &quot;7&quot;,&quot;H_RESET&quot;,&quot;1 resets internal registers and restores default. Auto clears.&quot;</span>
<span class="sd">   &quot;6&quot;,&quot;SLEEP&quot;,&quot;Sets chip to sleep mode.&quot;</span>
<span class="sd">   &quot;5&quot;,&quot;CYCLE&quot;,&quot;Sets chip to a single sample mode. (Not used)&quot;</span>
<span class="sd">   &quot;4&quot;,&quot;GYRO_STANDBY&quot;,&quot;Lower power mode for Gyros.&quot;</span>
<span class="sd">   &quot;3&quot;,&quot;PD_PTAT&quot;,&quot;Power done internal PTAT voltage generator. (Not used)&quot;</span>
<span class="sd">   &quot;2-0&quot;,&quot;CLKSEL&quot;,&quot;Selects clock speed.&quot;</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">SMPLRT_DIV</span>   <span class="o">=</span> <span class="mh">0x19</span>  <span class="c1"># 25</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Sample Rate Divider register. </span>

<span class="sd">Internal sample rate divided by this number to generate the final sample rate.</span>

<span class="sd">.. csv-table:: Bit Mapping</span>
<span class="sd">   :header: &quot;Bit&quot;,&quot;Name&quot;,&quot;Description&quot;</span>
<span class="sd">   </span>
<span class="sd">   &quot;7-0&quot;, &quot;SMPLRT_DIV&quot;, &quot;Sample Rate Divider&quot;</span>

<span class="sd">`Final Sample Rate` = Internal_Sample_Rate / (1 + SMPLRT_DIV)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="n">CONFIG</span>       <span class="o">=</span> <span class="mh">0x1A</span>  <span class="c1"># 26</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Configuration. </span>

<span class="sd">.. csv-table:: Bit Mapping</span>
<span class="sd">   :header: &quot;Bit&quot;,&quot;Name&quot;,&quot;Description&quot;</span>
<span class="sd">   </span>
<span class="sd">   &quot;7&quot;,&quot;-&quot;,&quot;reserved&quot;</span>
<span class="sd">   &quot;6&quot;,&quot;FIFO_MODE&quot;,&quot;1 means additional writes will not be added to fifo&quot;</span>
<span class="sd">   &quot;5-3&quot;,&quot;EXT_SYNC_SET&quot;,&quot;Enables FSYNC pin data to be sampled for short strobes&quot;</span>
<span class="sd">   &quot;2-0&quot;, DLPF_CFG&quot;,&quot;Not used&quot;</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">GYRO_CONFIG</span>  <span class="o">=</span> <span class="mh">0x1B</span>  <span class="c1"># 27</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">**Gyroscope configuration**</span>

<span class="sd">.. csv-table:: Bit Mapping</span>
<span class="sd">   :header: &quot;Bit&quot;,&quot;Name&quot;,&quot;Description&quot;</span>
<span class="sd">   </span>
<span class="sd">   &quot;7&quot;,&quot;XGYRO_Cten&quot;,&quot;X Gyro Self Test&quot;</span>
<span class="sd">   &quot;6&quot;,&quot;YGYRO_Cten&quot;,&quot;Y Gyro Self Test&quot;</span>
<span class="sd">   &quot;5&quot;,&quot;ZGYRO_Cten&quot;,&quot;Z Gyro Self Test&quot;</span>
<span class="sd">   &quot;4-3&quot;,&quot;GYRO_FS_SEL&quot;,&quot;Sets Gyro sample rate&quot;</span>
<span class="sd">   &quot;2&quot;,&quot;-&quot;,&quot;reserved&quot;</span>
<span class="sd">   &quot;1&quot;,&quot;Fchoice_b&quot;,&quot;Bypass dplf - not used&quot;</span>
<span class="sd">   </span>
<span class="sd">GYRO_FS_SEL sample rates are:</span>
<span class="sd"> - 00 = +250 degrees/second</span>
<span class="sd"> - 01 = +500 degrees/second</span>
<span class="sd"> - 10 = +1000 degrees/second</span>
<span class="sd"> - 11 = +2000 degrees/second</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="n">ACCEL_CONFIG</span> <span class="o">=</span> <span class="mh">0x1C</span>  <span class="c1"># 28</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">**Accelerometer configuration**</span>

<span class="sd">.. csv-table:: Bit Mapping</span>
<span class="sd">   :header: &quot;Bit&quot;,&quot;Name&quot;,&quot;Description&quot;</span>
<span class="sd">   </span>
<span class="sd">   &quot;7&quot;,&quot;ax_st_en&quot;,&quot;X Accel Self Test&quot;</span>
<span class="sd">   &quot;6&quot;,&quot;ay_st_en&quot;,&quot;Y Accel Self Test&quot;</span>
<span class="sd">   &quot;5&quot;,&quot;az_st_en&quot;,&quot;Z Accel Self Test&quot;</span>
<span class="sd">   &quot;4-3&quot;,&quot;ACCEL_FS_SEL&quot;,&quot;Sets Accel Sample rate&quot;</span>
<span class="sd">   &quot;2-0&quot;,&quot;-&quot;,&quot;reserved&quot;</span>
<span class="sd">   </span>
<span class="sd">ACCEL_FS_SEL sample rates are:</span>
<span class="sd"> - 00 = +-2 g/second</span>
<span class="sd"> - 01 = +-4 g/second</span>
<span class="sd"> - 10 = +-8 g/second</span>
<span class="sd"> - 11 = +-16 g/second</span>
<span class="sd"> </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">INT_ENABLE</span>   <span class="o">=</span> <span class="mh">0x38</span>  <span class="c1"># 56</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">**Interrupt Enable**</span>

<span class="sd">.. csv-table:: Bit Mapping</span>
<span class="sd">   :header: &quot;Bit&quot;,&quot;Name&quot;,&quot;Description&quot;</span>
<span class="sd">   </span>
<span class="sd">   &quot;7&quot;,&quot;WOM_EN&quot;,&quot;1 - enable interrupt for wake on motion&quot;</span>
<span class="sd">   &quot;6&quot;,&quot;-&quot;,&quot;reserved&quot;</span>
<span class="sd">   &quot;5&quot;,&quot;FIFO_OVERFLOW_EN&quot;,&quot;1 - enable interrupt fifo overflow&quot;</span>
<span class="sd">   &quot;4&quot;,&quot;FSYNC_INT_EN&quot;,&quot;1 - enable fsync interrupt&quot;</span>
<span class="sd">   &quot;3&quot;,&quot;-&quot;,&quot;reserved&quot;</span>
<span class="sd">   &quot;2&quot;,&quot;-&quot;,&quot;reserved&quot;</span>
<span class="sd">   &quot;1&quot;,&quot;RAW_RDY_EN&quot;,&quot;1 - enable raw sensor data ready interrupt&quot;</span>
<span class="sd">   </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">ACCEL_XOUT_H</span> <span class="o">=</span> <span class="mh">0x3B</span>  <span class="c1"># 59</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">X-Accelerometer High Byte</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">ACCEL_YOUT_H</span> <span class="o">=</span> <span class="mh">0x3D</span>  <span class="c1"># 61</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Y-Accelerometer High Byte</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">ACCEL_ZOUT_H</span> <span class="o">=</span> <span class="mh">0x3F</span>  <span class="c1"># 63</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Z-Accelerometer High Byte</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">TEMP_OUT_H</span>   <span class="o">=</span> <span class="mh">0x41</span>  <span class="c1"># 65</span>
<span class="n">GYRO_XOUT_H</span>  <span class="o">=</span> <span class="mh">0x43</span>  <span class="c1"># 67</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">X-Gyro High Byte</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">GYRO_YOUT_H</span>  <span class="o">=</span> <span class="mh">0x45</span>  <span class="c1"># 69</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Y-Gyro High Byte</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">GYRO_ZOUT_H</span>  <span class="o">=</span> <span class="mh">0x47</span>  <span class="c1"># 71</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Z-Gyro High Byte</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#AK8963 registers</span>
<span class="n">AK8963_ADDR</span>   <span class="o">=</span> <span class="mh">0x77</span>  <span class="c1"># 119</span>
<span class="n">AK8963_ST1</span>    <span class="o">=</span> <span class="mh">0x02</span>  <span class="c1"># 2</span>
<span class="n">HXH</span>          <span class="o">=</span> <span class="mh">0x04</span>  <span class="c1"># 4</span>
<span class="n">HYH</span>          <span class="o">=</span> <span class="mh">0x06</span>  <span class="c1"># 6</span>
<span class="n">HZH</span>          <span class="o">=</span> <span class="mh">0x08</span>  <span class="c1"># 8</span>
<span class="n">AK8963_ST2</span>   <span class="o">=</span> <span class="mh">0x09</span>  <span class="c1"># 9</span>
<span class="n">AK8963_CNTL</span>  <span class="o">=</span> <span class="mh">0x0A</span>  <span class="c1"># 10</span>
<span class="n">mag_sens</span> <span class="o">=</span> <span class="mf">4900.0</span> <span class="c1"># magnetometer sensitivity: 4800 uT</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># start I2C driver</span>
    <span class="n">bus</span> <span class="o">=</span> <span class="n">smbus</span><span class="o">.</span><span class="n">SMBus</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># start comm with i2c bus</span>
    <span class="n">gyro_sens</span><span class="p">,</span><span class="n">accel_sens</span> <span class="o">=</span> <span class="n">MPU6050_start</span><span class="p">()</span> <span class="c1"># instantiate gyro/accel</span>
    <span class="c1"># AK8963_start() # instantiate magnetometer</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">bus</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    bus is initialized to smbus</span>
<span class="sd">    </span>
<span class="sd">    :type: :py:class:`smbus2.SMBus`</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gyro_sens</span> <span class="o">=</span> <span class="mi">250</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    set to returned value from :py:func:`MPU6050_start`, which is 250 degrees per second</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">accel_sens</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    set to returned value from :py:func:`MPU6050_start`, which is 2 Gs per second</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>

	    </div>
            <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Karl Miller.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/jucacrispim/sphinx_pdj_theme">theme</a> provided by <a href="http://poraodojuca.net">Por√£o do Juca</a>.

</footer>
	</div>
	</div>
	  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
    <script type="text/javascript" src="../_static/jquery.js">

    </script>
    <script type="text/javascript" src="../_static/underscore.js">

    </script>
    <script type="text/javascript" src="../_static/doctools.js">

    </script>

  

   <script type="text/javascript"
           src="../_static/js/theme.js"></script>

   <script type="text/javascript"
           src="../_static/js/pdj.js"></script>

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

  </body>
</html>